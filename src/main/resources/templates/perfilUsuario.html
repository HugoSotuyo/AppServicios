<!DOCTYPE html>
<html style="font-size: 16px;" lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
        <meta name="keywords" content="Sample Headline">
        <meta name="description" content="">
        <title>Perfil</title>
        <link rel="stylesheet" href="/css/nicepage.css" media="screen">
        <link rel="stylesheet" href="/css/nicepage2.css" media="screen">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
        <link rel="stylesheet" href="/src/main/resources/static/css/usuario_lista.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
              integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
              integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous" />

        <link rel="stylesheet" th:href="@{/css/navbar.css}" />
        <link rel="stylesheet" th:href="@{/css/main.css}" />
        <link rel="icon" type="image/png" sizes="16x16" href="./logo/Logo_FINAL.png" />
        <script th:src="@{https://code.jquery.com/jquery-3.6.0.min.js}"></script>

        <!-- Incluye Popper.js -->
        <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js}"></script>
        <script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js}"
                integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
        crossorigin="anonymous"></script>


    </head>

    <body class="u-body u-xl-mode">
        <!--------NAVBAR 2------>
        <nav th:replace="~{/fragments/navbar :: nav}"
             th:with="idImagen=${idImagen},id=${id}, nombre=${nombre}, apellido=${apellido}, barrio=${barrio}, direccion=${direccion}, email=${email}, rol=${rol}">
        </nav>


        <section class="u-clearfix u-color-scheme-u10 u-section-1" id="sec-fa57">


            <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">


                <div class="u-clearfix u-expanded-width u-gutter-0 u-layout-wrap u-layout-wrap-1">

                    <div class="u-gutter-0 u-layout">

                        <div class="u-layout-row">

                            <div class="u-size-30 u-size-60-md">

                                <div class="u-layout-col">

                                    <div
                                        class="u-align-left u-container-style u-layout-cell u-left-cell u-size-40 u-layout-cell-1">

                                        <div class="u-container-layout u-valign-top u-container-layout-1">
                                            <h2 class="u-text u-text-default u-text-1">Mi perfil</h2>
                                        </div>

                                    </div>

                                    <div class="u-container-style u-image u-layout-cell u-left-cell u-size-20 u-image-1"
                                         src="" data-image-width="275" data-image-height="183"
                                         style="max-width: 275px; max-height: 183px; overflow: hidden;">
                                        <img class="logo" th:if="${idImagen != null}"
                                             th:src="@{/imagen/fotoPerfil/__${idImagen}__}"
                                             style="width: 100%; height: auto;" />
                                    </div>

                                </div>
                            </div>



                            <div class="u-size-30 u-size-60-md">
                                <div class="u-layout-col">

                                    <div
                                        class="u-align-left u-container-style u-layout-cell u-right-cell u-size-20 u-layout-cell-3">

                                        <div class="u-container-layout u-valign-top u-container-layout-3">
                                            <br><br><br>
                                            <h4 class="u-text u-text-default u-text-2">Datos Personales</h4>

                                            <p class="u-text u-text-3">
                                                <span style="font-weight: 700;">Nombre:</span>
                                                <span th:text="${usuario.nombre}"></span> <br>

                                                <span style="font-weight: 700;">Apellido:</span>
                                                <span th:text="${usuario.apellido}"></span> <br>

                                                <span style="font-weight: 700;"> Barrio: </span>
                                                <span th:text="${usuario.barrio}"> </span> <br>

                                                <span style="font-weight: 700;">Direccion:</span> 
                                                <span th:text="${usuario.direccion}"></span> <br>
                                            </p>

                                            <div
                                                class="u-align-left u-container-style u-layout-cell u-right-cell u-size-40 u-layout-cell-4">


                                                <div class="u-container-layout u-valign-bottom u-container-layout-4">

                                                    <p class="u-text u-text-4">

                                                        <span style="font-weight: 700;">Rol:</span> <span
                                                            th:text="${usuario.rol.toString()}"></span><br>

                                                        <span style="font-weight: 700;">Estado:</span>
                                                        <span th:if="${usuario.activo == true}">Activo</span>
                                                        <span th:if="${usuario.activo == false}">Inactivo</span>

                                                        <span style="font-weight: 700;">Email:</span> <span
                                                            th:text="${usuario.email}"></span><br>

                                                        <span style="font-weight: 700;">Contrase√±a:</span> *******

                                                    </p>
                                                    <div>
                                                        <a th:href="@{/actualizarUser}"
                                                           class="u-btn u-button-style u-text-body-color u-btn-1">
                                                            üõ† Actualizar mis datos personales
                                                        </a>
                                                    </div>

                                                    <div>
                                                        <a th:href="@{/serProveedor}" class="u-btn u-button-style u-text-body-color u-btn-1">
                                                            ¬°Quiero ser proveedor!
                                                        </a>
                                                    </div>

                                                </div>



                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </section>



        <!-- TRABAJOS SOLICITADOS USER-->
        <div th:if="${usuario.rol == T(com.GrupoE.WebAppServicios.enumeraciones.Rol).USER  }">
            <div class="container m-5">
                <h3> Aqu√≠ puede ver todos los trabajos Solicitados </h3>
                <div th:if="${TodosUsuario.isEmpty() || TodosUsuario == null}">
                    <p> A√∫n no ha solicitado nung√∫n trabajo </p>
                </div>
                <table class="table table-success table-hover table-striped"
                       th:if="${TodosUsuario != null && !TodosUsuario.isEmpty()}">
                    <thead class="align-items-center">
                        <tr>
                            <th scope="col">Proveedor</th>
                            <th scope="col">Descripci√≥n</th>
                            <th scope="col">Estado de la Solicitud</th>
                            <th scope="col">Realizado</th>
                            <th scope="col">Calificaci√≥n</th>
                            <th scope="col">Comentario de la calificaci√≥n</th>
                            <th scope="col">Cancelar solicitud</th>
                        </tr>
                    </thead>
                    <tbody class="table-group-divider" th:each="trabajo : ${TodosUsuario}">
                        <tr>
                            <th
                                th:text="${trabajo.proveedor != null ? trabajo.proveedor.nombre + ' ' + trabajo.proveedor.apellido : 'Proveedor no disponible'}">
                            </th>
                            <td th:text="${trabajo.descripcion}"></td>
                            <td>
                                <span th:if="${trabajo.solicitud == 'ACEPTADA'}">Aceptada</span>
                                <span th:if="${trabajo.solicitud == 'RECHAZADA'}">Rechazada</span>
                                <span th:if="${trabajo.solicitud == '0'}"> A√∫n no hay respuesta del proveedor </span>
                                <span th:if="${trabajo.solicitud == 'RECHAZADA POR USUARIO'}"> Has cancelado esta
                                    solicitud</span>
                            </td>
                            <td>
                                <span th:if="${trabajo.realizado}">Finalizado</span>
                                <span th:unless="${trabajo.realizado}">A√∫n no se ha marcado como finalizado</span>
                            </td>
                            <td
                                th:text="${trabajo.calificacion > 0 ? trabajo.calificacion : 'Ya puede calificar este trabajo en el apartado calificaciones pendientes'}">
                            </td>

                            <td th:text="${trabajo.comentario}"></td>

                            <td style="align-items: center;">
                                <span
                                    th:if="${trabajo.realizado == false and (trabajo.solicitud != 'RECHAZADA' and trabajo.solicitud != 'RECHAZADA POR USUARIO')}">
                                    <form th:action="@{/trabajo/cancelarSolicitud/__${trabajo.id}__}" method="post">
                                        <input type="hidden" id="trabajoId" th:value="${trabajo.id}" />
                                        <button type="submit">Cancelar</button>
                                    </form>
                                </span>
                                <span
                                    th:if="${trabajo.realizado == true or trabajo.solicitud == 'RECHAZADA POR USUARIO'}">No
                                    se permite cancelar</span>
                            </td>

                        </tr>

                    </tbody>
                </table>
            </div>
        </div>

        <!--calificaci√≥n USER-->
        <div th:if="${usuario.rol == T(com.GrupoE.WebAppServicios.enumeraciones.Rol).USER  }">
            <div class="container m-5">
                <h3> Calificar Trabajos </h3>
                <div th:if="${RealizadosNoCalificados == null || RealizadosNoCalificados.isEmpty()}">
                    <p> No hay trabajos para calificar en este momento...</p>
                </div>
                <div th:if="${RealizadosNoCalificados != null && !RealizadosNoCalificados.isEmpty()}">
                    <form th:action="@{/trabajo/calificar}" method="post">
                        <label for="elemento"> Selecciona el trabajo que desea calificar </label>
                        <select name="trabajoId">
                            <option th:each="trabajo : ${RealizadosNoCalificados}" th:value="${trabajo.id}"
                                    th:text="${trabajo.proveedor != null ? trabajo.proveedor.nombre + ' ' + trabajo.proveedor.apellido : 'Nombre no disponible'} + ' - ' + ${trabajo.descripcion}">
                            </option>
                        </select>
                        <div>
                            <label for="calificacion"> Calificaci√≥n: </label>
                            <select id="calificacion" name="calificacion">
                                <option th:value="1.0">1</option>
                                <option th:value="2.0">2</option>
                                <option th:value="3.0">3</option>
                                <option th:value="4.0">4</option>
                                <option th:value="5.0">5</option>
                            </select>
                        </div>
                        <div>
                            <input type="hidden" name="usuarioId" th:value="${id}" />

                        </div>

                        <div>
                            <label for="comentario">Comentario:</label>
                            <textarea id="comentario" name="comentario" rows="4" cols="50"></textarea><!--th:name="${comentario}"-->
                        </div>
                        <div>
                            <input type="hidden" name="proveedorId" th:value="${id}" />

                        </div> 
                        <div style="align-items: center;">
                            <button type="submit"> Enviar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-------FOOTER------>
        <footer th:replace="~{/fragments/footer :: footer}"
                th:with="id=${id}, nombre=${nombre}, apellido=${apellido}, barrio=${barrio}, direccion=${direccion}, email=${email}, imagen=${imagen}, rol=${rol}">
        </footer>
        <script th:src="@{/js/dropdown.js}" type="text/javascript"></script>
    </body>

</html>